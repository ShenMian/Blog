# 反汇编器

**英文**: Disassembler.  

!!! info
    由于许多反汇编器已经同时具备静态分析和动态调试功能, 因此这里反汇编器同时指代逆向工程框架.  

- [IDA Pro](https://hex-rays.com/ida-pro/): 可调试, 反编译, 跨平台, 天价.
- [Ghidra](https://github.com/NationalSecurityAgency/ghidra): 可调试, 反编译, 免费, 开源, 跨平台.
- [Radare2](https://github.com/radareorg/radare2): 可调试, 免费, 开源, 命令行.

## IDA Pro

![IDA Pro "VSCode Dark Theme"](assets/ida_pro.png)  

- 提供了只包含部分功能的免费版本 [IDA Free](https://hex-rays.com/ida-free/).  
- 部分键位和大多数软件并不相同, 具体请参考[快捷键](https://www.hex-rays.com/products/ida/support/freefiles/IDA_Pro_Shortcuts.pdf).  

## Ghidra

![Ghidra 2019年3月](./assets/ghidra_201903.png)  

这是一个由 NSA 维护的项目, 因此即使是开源项目也需谨慎使用.  

!!! warning
    该项目还存在未修复的已知的远程可执行漏洞 [CVE-2021-44228](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2021-44228), 详情请参考[安全警告](https://github.com/NationalSecurityAgency/ghidra#security-warning).  

## Radare2

![Radare2](./assets/radare2.png)  

常用插件:  

- [iaito](https://github.com/radareorg/iaito) 为 Radare2 提供了一个 GUI.  
- [r2ghidra](https://github.com/radareorg/r2ghidra) Ghidra 反编译器的集成.

更多内容请参考[插件](https://github.com/radareorg/radare2#plugins).  

[安装方法](https://github.com/radareorg/radare2#installation).  

### 快速入门

1. 启动

    ```sh
    r2 [程序名称]
    r2 -d [程序名称] # 如果想对程序进行调试需添加 -d 选项
    ```

    之后便进入 radar2 内部的命令行.  

2. 分析

    ```sh
    > aaa      # 对全部函数进行分析
    > afl      # 列出全部函数
    > afl~main # 查看包含特定关键字的函数
    ```

    其中 `~` 类似 `| grep `, 可在不同命令中使用.  

3. 反编译

    ```sh
    > s main # 定位到指定函数
    > pdf    # 输出反编译结果
    ```

4. [视觉模式](https://r2wiki.readthedocs.io/en/latest/options/capv/visual-mode/)

    ```sh
    V  # 进入 V(视觉) 模式
    VV # 进入 VV(流程图) 模式
    ```

    进入视觉模式后可以按 `p` 进行切换, 按 ` `/`V` 在 V 和 VV 模式之间切换, 按 `Shift+!` 进入视觉面板模式, 即可以同时启用多个窗口显示不同内容.  
    VV 模式下, 可以使用 `+`/`-` 进行缩放.  

5. 调试

    | 按键 | 描述     |
    | ---- | -------- |
    | F2   | 设置断点 |
    | F7   | 单步步入 |
    | F8   | 单步步过 |
    | F9   | 执行     |

    ```sh
    > iz             # 输出字符串
    > pf @ [变量名]   # 输出变量的值
    > pf z @ [变量名] # 输出 null-terminated 字符串变量的值
    ```

## 调试器

### x64dbg

![x64dbg](./assets/x64dbg.png)  

开源, 免费, 只支持 Windows. 详情请参考[项目主页](https://github.com/x64dbg/x64dbg)和[官网](https://x64dbg.com/).  
是 OllyDbg(于 2013 停止维护)良好的替代品).  

### GDB

#### 快速入门

```sh
# 执行
r [args]              # run, 执行程序
c                     # cotinue, 继续执行
s                     # step, 源码级单步步入
n                     # next, 源码级单步步过
si                    # step inst, 指令级单步步入
ni                    # next inst, 指令级单步步过
finish                # 步出
until [n]             # 执行到第 n 行

# 断点
b [file:][func, line] # break, 添加断点
delete [id]           # 删除指定 id 的断点
disable [id]          # 禁用指定 id 的断点
enable [id]           # 启用指定 id 的断点
i b                   # info break, 列出断点信息

# 变量
i args                # info args, 列出当前函数参数
i locals              # info locals, 列出局部变量
p [var]               # print, 输出变量 var 的值

# 其他
i r                   # info register, 列出寄存器信息
bt                    # backtrace, 输出调用栈
dis [func]            # disassemble, 输出函数 func 的反汇编, func 缺省则输出前函数的
q                     # quit, 退出
```

#### 插件

安装 pwndbg:  

```sh
git clone https://github.com/pwndbg/pwndbg
cd pwndbg
./setup.sh
```

!!! warning
    安装后需保留本地仓库.  

安装 peda:  

```sh
git clone https://github.com/longld/peda.git ~/peda
echo "source ~/peda/peda.py" >> ~/.gdbinit  
```

!!! warning
    安装后需保留本地仓库.

安装 GEF:

```sh
bash -c "$(curl -fsSL https://gef.blah.cat/sh)"
```

### GDB 与 LLDB

- 可以对代码进行反汇编, 但只是简单的输出反汇编代码. 可以搭配 Radare2 使用, 同时具备调试和反汇编功能.  
- 所使用的指令是不完全相同的, 请查看[具体区别](https://lldb.llvm.org/use/map.html).  

使用 intel 汇编语法:  

```sh
set disassembly-flavor intel                     # GDB
settings set target.x86-disassembly-flavor intel # LLDB
```
