# 隐写

**英文**: Steganography.  

## 确定文件类型

对文件进行分析.  

```sh
file [file]
```

!!! info "CTF"
    若识别文件类型后使用相应软件无法打开可能是头部的 magic 数字缺失, 在文件头部添加对应的 magic 数字即可. 文件类型可能会通过文件名字暗示.  

## 常见文件头尾

### 图片

| 类型                  | 文件头                                    | 文件尾      |
| --------------------- | ----------------------------------------- | ----------- |
| JPEG                  | FF D8 FF                                  | FF D9       |
| PNG                   | 89 50 4E 47 0D 0A 1A 0A                   | AE 42 60 82 |
| GIF                   | 47 49 46 38 39(37) 61                     | 00 3B       |
| BMP                   | 42 4D                                     |             |
| TIFF(tif)             | 49 49 2A 00                               |             |
| ico                   | 00 00 01 00                               |             |
| Adobe Photoshop (psd) | 38 42 50 53                               |             |
| TGA                   | 未压缩 00 00 02 00 RLE压缩 00 00 10 00 00 |             |

### Office

| 类型                        | 文件头                                                                         |
| --------------------------- | ------------------------------------------------------------------------------ |
| MS Word/Excel (xls.or.doc)  | D0 CF 11 E0                                                                    |
| MS Access (mdb)             | 53 74 61 6E 64 61 72 64 20 4A                                                  |
| WordPerfect (wpd)           | FF 57 50 43                                                                    |
| Adobe Acrobat (pdf)         | 25 50 44 46 2D 31 2E                                                           |
| application/vnd.visio(vsd)  | D0 CF 11 E0 A1 B1 1A E1                                                        |
| Email [thorough only] (eml) | 44 65 6C 69 76 65 72 79 2D 64 61 74 65 3A                                      |
| Outlook Express (dbx)       | CF AD 12 FE C5 FD 74 6F                                                        |
| Outlook (pst)               | 21 42 44 4E                                                                    |
| Rich Text Format (rtf)      | 7B 5C 72 74 66                                                                 |
| txt                         | Unicode：FE FF / Unicode big endian：FF FE / UTF-8：EF BB BF /ANSI编码无文件头 |

### 压缩包

| 类型              | 文件头      | 文件尾 |
| ----------------- | ----------- | ------ |
| ZIP Archive (zip) | 50 4B 03 04 | 50 4B  |
| RAR Archive (rar) | 52 61 72 21 |        |

### 音频文件

| 类型             | 文件头      |
| ---------------- | ----------- |
| Wave (wav)       | 57 41 56 45 |
| audio(Audio)     | 4D 54 68 64 |
| audio/x-aac(aac) | FF F1(9)    |

### 视频文件

| 类型                | 文件头                  |
| ------------------- | ----------------------- |
| AVI (avi)           | 41 56 49 20             |
| Real Audio (ram)    | 2E 72 61 FD             |
| Real Media (rm)     | 2E 52 4D 46             |
| MPEG (mpg)          | 00 00 01 BA(3)          |
| Quicktime (mov)     | 6D 6F 6F 76             |
| Windows Media (asf) | 30 26 B2 75 8E 66 CF 11 |
| MIDI (mid)          | 4D 54 68 64             |

### 代码文件

| 类型                   | 文件头         |
| ---------------------- | -------------- |
| XML (xml)              | 3C 3F 78 6D 6C |
| HTML (html)            | 68 74 6D 6C 3E |
| Quicken (qdf)          | AC 9E BD 8F    |
| Windows Password (pwl) | E3 82 85 96    |

### 其他类型

| 类型                   | 文件头                  |
| ---------------------- | ----------------------- |
| windows证书文件(der)   | 30 82 03 C9             |
| CAD (dwg)              | 41 43 31 30             |
| Windows Shortcut (lnk) | 4C 00 00 00             |
| Windows reg(reg)       | 52 45 47 45 44 49 54 34 |

## 文件分离

识别并分离又多个文件合成的单个文件.  

```sh
binwalk [file]    # 分析
binwalk -e [file] # 分离
```

binwalk 只是将附加的文件分离出来, 不包含第一个文件.  
若 binwalk 无法成功识别和分离, 可以使用 foremost:  

```sh
foremost [file] # 分离
cat output/audit.txt
```

foremost 并没有在标准输出中直接给出有价值的信息, 而是写入到了输出目录中的 `audit.txt` 文件里.  

当多个文件数据不是简单的依次追加在文件末尾时, 自动分离便会失效或输出无效内容. 这时需要进人工动分析并手动分离.  

```sh
dd if=[in_file] of=[out_file] bs=[block_size] count=[block_count] skip=[block_skip]
```

将 `in_file` 中从 `block_skip * block_size` 处开始大小为 `block_size * block_count` 的数据写入到 `out_file` 中.  
若数据不是一块一块的, 则可以将 `block_size` 设置为 1(默认单位为字节), 这样 `block_count` 就表示要导出的字节数, `block_skip` 表示要跳过的字节数.  

## 文件合并

```sh
cat [file1] [file2] > [out_file]
copy /B [file1]+[file2] [out_file] # Windows
```
